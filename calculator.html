---
layout: default
title: Calculator
---
<section>
<div class="container">
	<div class="calculator">
		<div class="left">
			<div><label>Purchase Price</label><input type="number" name="purchase-price"></div>
			<div><label>Down Payment</label><input type="number" name="down-payment"></div>
			<div><label>Finance Amount</label><input type="number" name="finance-amount">
			<!-- <button class="finance-amount">calculate</button> -->
			</div>
			<div><label>Interest Type</label>
			<input type="radio" name="interest-type" value="amortized" id="amortized" checked><label for="amortized" style="min-width: 93px;">Amortized</label>
			<input type="radio" name="interest-type" value="simple" id="simple"><label for="simple" style="min-width: 64px;">Simple</label>
			</div>
			<div><label>Annual Interest Rate</label><input readonly style="width: 50px;" type="text" value="2.50%"><input type="range" min="0" max="10" value="2.5" step="0.25" name="interest-rate" class="interest-rate-range">
			</div>
			<div class="amortized-months"><label>Amortized Months</label><input type="number" name="amortized-months" value="360">
			</div>
			<div style="display: none;" class="principal-percentage"><label>Principal %</label><input readonly style="width: 50px;" type="text" value="50%"><input type="range" min="0" max="99" value="50" name="principal-percentage" class="principal-percentage-range">
			</div>
			<div><label>Payment</label><input type="number" name="payment">
			</div>
			<div><label>Term Months</label><input type="number" name="term-months" value="96">
			</div>
			<div>
				<label>Balloon</label><input readonly style="max-width: 128px;" type="number" name="balloon">
				<label style="min-width: 37px;">LTV</label><input style="max-width: 100px;" readonly type="text" name="ltv">
			</div>
			<div><label>Total</label><input readonly type="number" name="total"></div>
			<hr>
			<div><label>Monthly Rents</label><input type="number" name="rents"></div>
			<div><label>Monthly Expenses</label><input type="number" name="expenses"></div>
			<div><label>Cashflow</label><input type="number" name="cashflow"></div>
		</div>
		<div class="right">
			<div class="progress-bar">
				<div class="progress-container">
					<div class="progress"></div>
				</div>
				<div class="progress-labels">
					<label>cashflow 700</label>
					<label>cashflow 350</label>
					<label>break even</label>
					<label>bad deal</label>
				</div>
				<!-- bad deal, break even, cfashflow > 350, cashflow > 700 -->
			</div>
		</div>
		<!-- how is time valued? use 2x over 30 years as benchmark -->
	</div>
<script>
var interestType = 'amortized';
document.querySelectorAll('[name="purchase-price"], [name="down-payment"], [name="finance-amount"]').forEach(function (field) {
	field.addEventListener('input', function (e) {
		var pp = document.querySelector('[name="purchase-price"]');
		var dp = document.querySelector('[name="down-payment"]');
		var fa = document.querySelector('[name="finance-amount"]');
		var ppVal = Number(pp.value);
		var dpVal = Number(dp.value);
		var faVal = Number(fa.value);
		if (!ppVal && pp !== field) pp.value = ppVal;
		if (!dpVal && dp !== field) dp.value = dpVal;
		if (!faVal && fa !== field) fa.value = faVal;
		switch (field.name) {
			case 'purchase-price':
				fa.value = ppVal - dpVal;
			break;
			case 'down-payment':
				fa.value = ppVal - dpVal;
			break;
			case 'finance-amount':
				pp.value = faVal + dpVal;
			break;
		}
		calculate({className: 'payment'});
		calculate({className: 'balloon'});
	});
});

document.querySelectorAll('[name="rents"], [name="expenses"], [name="cashflow"]').forEach(function (field) {
	field.addEventListener('input', function (e) {
		var rs = document.querySelector('[name="rents"]');
		var ex = document.querySelector('[name="expenses"]');
		var cf = document.querySelector('[name="cashflow"]');
		var pmt = document.querySelector('[name="payment"]');
		var rsVal = Number(rs.value);
		var exVal = Number(ex.value);
		var cfVal = Number(cf.value);
		if (!rsVal && rs !== field) rs.value = rsVal;
		if (!exVal && ex !== field) ex.value = exVal;
		if (!cfVal && cf !== field) cf.value = cfVal;
		switch (field.name) {
			case 'rents':
				cf.value = rsVal - exVal - Number(pmt.value);
			break;
			case 'expenses':
				cf.value = rsVal - exVal - Number(pmt.value);
			break;
			case 'cashflow':
				rs.value = cfVal + exVal + Number(pmt.value);
			break;
		}
		calculate({className: ''});
	});
});

document.querySelectorAll('[name="interest-type"]').forEach(function (field) {
	field.addEventListener('change', function (e) {
		interestType = field.value;
		document.querySelector('.amortized-months').style.display = field.value === 'amortized' ? 'flex' : 'none';
		document.querySelector('.principal-percentage').style.display = field.value === 'simple' ? 'flex' : 'none';
		calculate({className: 'payment'});
		calculate({className: 'balloon'});
	});
});

document.querySelectorAll('[type="range"]').forEach(function (field) {
	field.addEventListener('input', function (e) {
		var number = Number(e.target.value);
		e.target.previousSibling.value = field.className === 'interest-rate-range' ? (number).toFixed(2) + '%' : number + '%';
		calculate({className: 'payment'});
		calculate({className: 'balloon'});
	});
});

document.querySelectorAll('[name="interest-rate"], [name="amortized-months"]').forEach(function (field) {
	field.addEventListener('input', function (e) {
		calculate({className: 'payment'});
		calculate({className: 'balloon'});
	});
});

document.querySelectorAll('[name="payment"], [name="term-months"], [name="principal-percentage"]').forEach(function (field) {
	// principalPercent = (-interest / payment) + 1
	field.addEventListener('input', function (e) {
		calculate({className: 'balloon'}, e);
	});
});

document.querySelectorAll('button').forEach(function (button) {
	button.addEventListener('click', function (e) {
		calculate(button);
	});
});

function calculate(button, e) {
	var fa = document.querySelector('[name="finance-amount"]');
	var int = document.querySelector('[name="interest-rate"]');
	var term = document.querySelector('[name="term-months"]');
	var amort = document.querySelector('[name="amortized-months"]');
	var pmt = document.querySelector('[name="payment"]');
	var principalPerc = document.querySelector('[name="principal-percentage"]');
	var balloon = document.querySelector('[name="balloon"]');
	var rs = document.querySelector('[name="rents"]');
	var ex = document.querySelector('[name="expenses"]');
	var cf = document.querySelector('[name="cashflow"]');
	var monthRate = Number(int.value) / 100 / 12;
	var termMonths = Number(term.value);
	var amortMonths = Number(amort.value);
	var downPayment = document.querySelector('[name="down-payment"]');

	switch (button.className) {
		case 'finance-amount':
			if (balloon.value) {
				fa.value = (!monthRate ? Number(balloon.value) / ((amortMonths - termMonths) / amortMonths) : Number(balloon.value) / ((Math.pow(1 + monthRate, amortMonths) - Math.pow(1 + monthRate, termMonths))/(Math.pow(1 + monthRate, amortMonths) - 1))).toFixed(2);
			}
		break;
		case 'interest-rate':
		break;
		case 'term-months':
		break;
		case 'payment':
			if (interestType === 'simple') {
				var interest = Number(fa.value) * monthRate;
				pmt.value = (-interest / (Number(principalPerc.value) / 100 - 1)).toFixed(2);
			} else {
				if (monthRate) {
					pmt.value = (Number(fa.value) * monthRate * Math.pow(1 + monthRate, amortMonths) / (Math.pow(1 + monthRate, amortMonths) - 1)).toFixed(2);
				} else {
					pmt.value = (Number(fa.value) / amortMonths).toFixed(2);
				}
			}
		break;
		case 'balloon':
			var balloonPayment;
			if (interestType === 'simple') {
				if (pmt.value) {
					balloonPayment = Number(fa.value) - (Number(pmt.value) - Number(fa.value) * monthRate) * termMonths;
				} else {
					balloonPayment = Number(fa.value);
				}
			} else {
				// balloonPayment = !monthRate ? Number(fa.value) * (amortMonths - termMonths) / amortMonths : Number(fa.value) * (Math.pow(1 + monthRate, amortMonths) - Math.pow(1 + monthRate, termMonths)) / (Math.pow(1 + monthRate, amortMonths) - 1);
				if (monthRate) {
					balloonPayment = Number(fa.value) * Math.pow(1 + monthRate, termMonths) - Number(pmt.value) / monthRate * (Math.pow(1 + monthRate, termMonths) - 1);
				} else {
					balloonPayment = Number(fa.value) - Number(pmt.value) * termMonths;
				}
			}
			balloon.value = balloonPayment.toFixed(2);
			if (balloonPayment && fa.value) {
				document.querySelector('[name="ltv"]').value = Math.round(balloonPayment / Number(fa.value) * 100) + '%';
			}
		break;
	}

	if (e && e.target.name === 'payment') {
		if (interestType === 'amortized') {
			if (monthRate) {
				amort.value = (Math.log(Number(pmt.value)/(Number(pmt.value) - Number(fa.value) * monthRate)) / Math.log(1 + monthRate)).toFixed(2);
			} else {
				amort.value = (Number(fa.value) / Number(pmt.value)).toFixed(2);
			}
		}
	}

	if (termMonths === amortMonths || balloon.value) {
		document.querySelector('[name="total"]').value = (Number(downPayment.value) + termMonths * Number(pmt.value) + Number(balloon.value)).toFixed(2);
	}
	if (rs.value) {
		cf.value = Math.round(Number(rs.value) - Number(ex.value) - Number(pmt.value));
	}
	if (cf.value) {
		var height = (Number(cf.value) + 350) / 1050  * 100;
		height = height > 100 ? 100 : height;
		height = height < 0 ? 0 : height;
		document.querySelector('.progress').style.height = height + '%';
	}
}
// it's better to make payments on an amortized loan vs simple. balloon is smaller, net is smaller
// balloon payment doesn't include future interest
// balloon = future value?
</script>
</div>
</section>
